import { Button, LineEdit, ComboBox, CheckBox } from "sixtyfps_widgets.60";
import { Transactions, TransactionView } from "./transactions.60";
import { Accounts, AccountView, AccountDialog } from "./accounts.60";
import { Budget } from "./budget.60";

export App := Window {
    property<[TransactionView]> transactions: [];
    property<[AccountView]> accounts: [];
    property<[string]> account-names: [];
    property<[string]> categories: [];
    property<string> show-view: "transactions";

    callback add-tx(string, string, string, string, float);
    callback add-category(string);
    callback add-account(string, float, bool);
    callback account-selected(int);

    callback show-transactions;
    
    show-transactions => {
        if (show-view != "transactions") {
            transactions = [];
            show-view = "transactions";
        }
    }
    
    min-width: 800px;
    min-height: 400px;
    
    preferred-width: 1200px;
    preferred-height: 800px;

    HorizontalLayout {
        VerticalLayout {
            padding: 10px;
            padding-right: 0;
            spacing: 6px;
            horizontal-stretch: 1;
            
            HorizontalLayout {
                padding: 6px;
                Text {
                    font-size: 16px;
                    text: "Budget";
                    overflow: elide;
                    height: 30px;
                    vertical-alignment: TextVerticalAlignment.center;
                    TouchArea {
                        clicked => {
                            root.show-view = "budget";
                        }
                    }
                }
            }
            HorizontalLayout {
                padding: 6px;
                Text {
                    font-size: 16px;
                    text: "Reports";
                    overflow: elide;
                    height: 30px;
                    vertical-alignment: TextVerticalAlignment.center;
                    TouchArea {
                        clicked => {
                            root.show-view = "reports";
                        }
                    }
                }
            }
            HorizontalLayout {
                padding: 6px;
                Text {
                    font-size: 16px;
                    text: "All Accounts";
                    overflow: elide;
                    height: 30px;
                    vertical-alignment: TextVerticalAlignment.center;
                    TouchArea {
                        clicked => {
                            root.show-transactions();
                            root.account-selected(-1);
                        }
                    }
                }
            }
            Accounts {
                min-width: 2in;
                accounts: root.accounts;
                account-selected(account-id) => {
                    root.show-transactions();
                    root.account-selected(account-id);
                }
                add-account-button-clicked() => {
                    account-dialog.modal-active = true;
                }
            }
        }

        Rectangle {
            horizontal-stretch: 7;
            if root.show-view == "budget": Budget {
                categories: root.categories;

                add-category(name) => {
                    root.add-category(name);
                }
            }
            if root.show-view == "reports": Rectangle {
                
            }
            if root.show-view == "transactions": Transactions {
                categories: root.categories;
                account-names: root.account-names;
                transactions: root.transactions;

                add-tx(account-name, payee-name, category-name, memo, amount) => {
                    root.add-tx(account-name, payee-name, category-name, memo, amount);
                }
            }
        }
    }

    account-dialog := AccountDialog {
        add-account(name, balance, is_tracking) => {
            root.add-account(name, balance, is_tracking);
        }
    }
}